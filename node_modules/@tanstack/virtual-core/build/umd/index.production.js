/**
 * virtual-core
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).VirtualCore={})}(this,(function(e){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},n.apply(this,arguments)}function t(e,n,t){var o,r=[];return function(){var i;t.key&&null!=t.debug&&t.debug()&&(i=Date.now());var l,s=e();if(!(s.length!==r.length||s.some((function(e,n){return r[n]!==e}))))return o;if(r=s,t.key&&null!=t.debug&&t.debug()&&(l=Date.now()),o=n.apply(void 0,s),null==t||null==t.onChange||t.onChange(o),t.key&&null!=t.debug&&t.debug()){var a=Math.round(100*(Date.now()-i))/100,u=Math.round(100*(Date.now()-l))/100,c=u/16,d=function(e,n){for(e=String(e);e.length<n;)e=" "+e;return e};console.info("%câ± "+d(u,5)+" /"+d(a,5)+" ms","\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl("+Math.max(0,Math.min(120-120*c,120))+"deg 100% 31%);",null==t?void 0:t.key)}return o}}var o=function(e){return e},r=function(e){for(var n=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),o=[],r=n;r<=t;r++)o.push(r);return o},i={element:["scrollLeft","scrollTop"],window:["scrollX","scrollY"]},l=function(e){return function(n,t){if(n.scrollElement){var o=i[e][0],r=i[e][1],l=n.scrollElement[o],s=n.scrollElement[r],a=function(){var e=n.scrollElement[n.options.horizontal?o:r];t(e)};a();var u=function(e){var t=e.currentTarget,i=t[o],u=t[r];(n.options.horizontal?l-i:s-u)&&a(),l=i,s=u};return n.scrollElement.addEventListener("scroll",u,{capture:!1,passive:!0}),function(){n.scrollElement.removeEventListener("scroll",u)}}}},s=l("element"),a=l("window"),u=function(e,n){return Math.round(e.getBoundingClientRect()[n.options.horizontal?"width":"height"])};e.Virtualizer=function(e){var i,l=this;this.unsubs=[],this.scrollElement=null,this.isScrolling=!1,this.isScrollingTimeoutId=null,this.measurementsCache=[],this.itemSizeCache={},this.pendingMeasuredCacheIndexes=[],this.scrollDirection=null,this.scrollAdjustments=0,this.measureElementCache={},this.pendingScrollToIndexCallback=null,this.getResizeObserver=(i=null,function(){return i||("undefined"!=typeof ResizeObserver?i=new ResizeObserver((function(e){e.forEach((function(e){l._measureElement(e.target,!1)}))})):null)}),this.range={startIndex:0,endIndex:0},this.setOptions=function(e){Object.entries(e).forEach((function(n){var t=n[0];void 0===n[1]&&delete e[t]})),l.options=n({debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:o,rangeExtractor:r,onChange:function(){},measureElement:u,initialRect:{width:0,height:0},scrollMargin:0,scrollingDelay:150,indexAttribute:"data-index",initialMeasurementsCache:[]},e)},this.notify=function(){null==l.options.onChange||l.options.onChange(l)},this.cleanup=function(){l.unsubs.filter(Boolean).forEach((function(e){return e()})),l.unsubs=[],l.scrollElement=null},this._didMount=function(){var e=l.getResizeObserver();return Object.values(l.measureElementCache).forEach((function(n){return null==e?void 0:e.observe(n)})),function(){null==e||e.disconnect(),l.cleanup()}},this._willUpdate=function(){null==l.pendingScrollToIndexCallback||l.pendingScrollToIndexCallback();var e=l.options.getScrollElement();l.scrollElement!==e?(l.cleanup(),l.scrollElement=e,l._scrollToOffset(l.scrollOffset,{adjustments:void 0,behavior:void 0}),l.unsubs.push(l.options.observeElementRect(l,(function(e){l.scrollRect=e,l.calculateRange()}))),l.unsubs.push(l.options.observeElementOffset(l,(function(e){if(l.scrollAdjustments=0,l.scrollOffset!==e){null!==l.isScrollingTimeoutId&&(clearTimeout(l.isScrollingTimeoutId),l.isScrollingTimeoutId=null);var n=function(e){l.isScrolling!==e&&(l.isScrolling=e,l.notify())};l.scrollDirection=l.scrollOffset<e?"forward":"backward",l.scrollOffset=e,l.calculateRange(),n(!0),l.isScrollingTimeoutId=setTimeout((function(){l.isScrollingTimeoutId=null,l.scrollDirection=null,n(!1)}),l.options.scrollingDelay)}})))):l.isScrolling||l.calculateRange()},this.getSize=function(){return l.scrollRect[l.options.horizontal?"width":"height"]},this.getMeasurements=t((function(){return[l.options.count,l.options.paddingStart,l.options.scrollMargin,l.options.getItemKey,l.itemSizeCache]}),(function(e,n,t,o,r){var i=l.pendingMeasuredCacheIndexes.length>0?Math.min.apply(Math,l.pendingMeasuredCacheIndexes):0;l.pendingMeasuredCacheIndexes=[];for(var s=l.measurementsCache.slice(0,i),a=i;a<e;a++){var u=o(a),c=r[u],d=s[a-1]?s[a-1].end:n+t,f="number"==typeof c?c:l.options.estimateSize(a),h=d+f;s[a]={index:a,start:d,size:f,end:h,key:u}}return l.measurementsCache=s,s}),{key:!1,debug:function(){return l.options.debug}}),this.calculateRange=t((function(){return[l.getMeasurements(),l.getSize(),l.scrollOffset]}),(function(e,n,t){var o=function(e){var n=e.measurements,t=e.outerSize,o=e.scrollOffset,r=n.length-1,i=function(e,n,t,o){for(;e<=n;){var r=(e+n)/2|0,i=t(r);if(i<o)e=r+1;else{if(!(i>o))return r;n=r-1}}return e>0?e-1:0}(0,r,(function(e){return n[e].start}),o),l=i;for(;l<r&&n[l].end<o+t;)l++;return{startIndex:i,endIndex:l}}({measurements:e,outerSize:n,scrollOffset:t});return o.startIndex===l.range.startIndex&&o.endIndex===l.range.endIndex||(l.range=o,l.notify()),l.range}),{key:!1,debug:function(){return l.options.debug}}),this.getIndexes=t((function(){return[l.options.rangeExtractor,l.range,l.options.overscan,l.options.count]}),(function(e,t,o,r){return e(n({},t,{overscan:o,count:r}))}),{key:!1,debug:function(){return l.options.debug}}),this.indexFromElement=function(e){var n=l.options.indexAttribute,t=e.getAttribute(n);return t?parseInt(t,10):(console.warn("Missing attribute name '"+n+"={index}' on measured element."),-1)},this._measureElement=function(e,t){var o,r=l.indexFromElement(e),i=l.measurementsCache[r];if(i){var s=l.measureElementCache[i.key],a=l.getResizeObserver();if(e.isConnected){s&&s===e||(s&&(null==a||a.unobserve(s)),l.measureElementCache[i.key]=e,null==a||a.observe(e));var u,c=l.options.measureElement(e,l),d=c-(null!=(o=l.itemSizeCache[i.key])?o:i.size);if(0!==d)i.start<l.scrollOffset&&l.isScrolling&&"backward"===l.scrollDirection&&l._scrollToOffset(l.scrollOffset,{adjustments:l.scrollAdjustments+=d,behavior:void 0}),l.pendingMeasuredCacheIndexes.push(r),l.itemSizeCache=n({},l.itemSizeCache,((u={})[i.key]=c,u)),l.notify()}else s&&(null==a||a.unobserve(s),delete l.measureElementCache[i.key])}},this.measureElement=function(e){e&&l._measureElement(e,!0)},this.getVirtualItems=t((function(){return[l.getIndexes(),l.getMeasurements()]}),(function(e,n){for(var t=[],o=0,r=e.length;o<r;o++){var i=n[e[o]];t.push(i)}return t}),{key:!1,debug:function(){return l.options.debug}}),this.getOffsetForAlignment=function(e,n){var t=l.scrollOffset,o=l.getSize();return"auto"===n&&(n=e<=t?"start":e>=t+o?"end":"start"),"start"===n?e:"end"===n?e-o:"center"===n?e-o/2:e},this.scrollToOffset=function(e,n){var t=void 0===n?{}:n,o=t.align,r=void 0===o?"start":o,i={adjustments:void 0,behavior:t.behavior,sync:!1};l._scrollToOffset(l.getOffsetForAlignment(e,r),i)},this.scrollToIndex=function(e,n){var t=void 0===n?{}:n,o=t.align,r=void 0===o?"auto":o,i=t.behavior;l.pendingScrollToIndexCallback=null;var s=l.scrollOffset,a=l.getSize(),u=l.options.count,c=l.getMeasurements()[Math.max(0,Math.min(e,u-1))];if(!c)throw new Error("VirtualItem not found for index = "+e);if("auto"===r)if(c.end>=s+a-l.options.scrollPaddingEnd)r="end";else{if(!(c.start<=s+l.options.scrollPaddingStart))return;r="start"}var d=function(e){var n="end"===r?e.end+l.options.scrollPaddingEnd:e.start-l.options.scrollPaddingStart;return l.getOffsetForAlignment(n,r)}(c);if(Math.round(d)!==Math.round(s)){var f={adjustments:void 0,behavior:i};l._scrollToOffset(d,f),Object.keys(l.measureElementCache).length>0&&(l.pendingScrollToIndexCallback=function(){l.scrollToIndex(e,{align:r,behavior:i})})}},this.scrollBy=function(e,n){l._scrollToOffset(l.scrollOffset,{adjustments:e,behavior:null==n?void 0:n.behavior})},this.getTotalSize=function(){var e;return((null==(e=l.getMeasurements()[l.options.count-1])?void 0:e.end)||l.options.paddingStart)-l.options.scrollMargin+l.options.paddingEnd},this._scrollToOffset=function(e,n){var t=n.adjustments,o=n.behavior;l.options.scrollToFn(e,{behavior:o,adjustments:t},l)},this.measure=function(){l.itemSizeCache={},l.notify()},this.setOptions(e),this.scrollRect=this.options.initialRect,this.scrollOffset=this.options.initialOffset,this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach((function(e){l.itemSizeCache[e.key]=e.size})),this.calculateRange()},e.defaultKeyExtractor=o,e.defaultRangeExtractor=r,e.elementScroll=function(e,n,t){var o,r,i=n.adjustments,l=void 0===i?0:i,s=n.behavior,a=e+l;null==(o=t.scrollElement)||null==o.scrollTo||o.scrollTo(((r={})[t.options.horizontal?"left":"top"]=a,r.behavior=s,r))},e.measureElement=u,e.memo=t,e.observeElementOffset=s,e.observeElementRect=function(e,n){var t=new ResizeObserver((function(e){var t,o;n({width:null==(t=e[0])?void 0:t.contentRect.width,height:null==(o=e[0])?void 0:o.contentRect.height})}));if(e.scrollElement)return n(e.scrollElement.getBoundingClientRect()),t.observe(e.scrollElement),function(){t.unobserve(e.scrollElement)}},e.observeWindowOffset=a,e.observeWindowRect=function(e,n){var t=function(e,n){var t={height:-1,width:-1};return function(o){(e.options.horizontal?o.width!==t.width:o.height!==t.height)&&n(o),t=o}}(e,n),o=function(){return t({width:e.scrollElement.innerWidth,height:e.scrollElement.innerHeight})};if(e.scrollElement)return o(),e.scrollElement.addEventListener("resize",o,{capture:!1,passive:!0}),function(){e.scrollElement.removeEventListener("resize",o)}},e.windowScroll=function(e,n,t){var o,r,i=n.adjustments,l=void 0===i?0:i,s=n.behavior,a=e+l;null==(o=t.scrollElement)||null==o.scrollTo||o.scrollTo(((r={})[t.options.horizontal?"left":"top"]=a,r.behavior=s,r))},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.production.js.map
